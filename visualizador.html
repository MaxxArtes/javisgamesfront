<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <style>
        /* Estilos globais do visualizador */
        body { background-color: #111; color: #d1d5db; font-family: 'Inter', sans-serif; }
        
        /* Área do Conteúdo (Onde o texto da aula entra) */
        .conteudo-aula { padding: 20px; max-width: 900px; margin: 0 auto; }
        
        /* Força as imagens do conteúdo a nunca estourarem a tela */
        .conteudo-aula img { 
            max-width: 100%; 
            height: auto; 
            border-radius: 8px; 
            display: block; 
            margin: 20px 0; 
        }

        /* Títulos e Textos do Conteúdo */
        .conteudo-aula h1 { font-size: 2rem; color: #00FFFF; margin-top: 1.5rem; font-weight: bold; }
        .conteudo-aula h2 { font-size: 1.5rem; color: #e5e7eb; margin-top: 1.5rem; border-left: 4px solid #00FFFF; padding-left: 10px; }
        .conteudo-aula p { margin-bottom: 1rem; line-height: 1.6; color: #d1d5db; }
        .conteudo-aula ul { list-style: disc; padding-left: 20px; margin-bottom: 1rem; }
        .conteudo-aula a { color: #3b82f6; text-decoration: underline; }
        
        /* Esconde elementos estruturais se eles vierem errados do banco */
        .conteudo-aula header, .conteudo-aula footer { display: none !important; } 
    </style>
</head>
<body class="min-h-screen flex flex-col">

    <header class="bg-[#1a1a1a] border-b border-[#333] sticky top-0 z-50 shadow-md">
        <div class="max-w-5xl mx-auto px-6 py-3 flex items-center justify-between">
            <div class="flex items-center gap-4">
                 <img src="assets/img/JAVIS - LOGO COM REGISTRO (BRANCO) (2).png" class="h-12">
                <div class="h-8 w-[1px] bg-gray-700 mx-2 hidden sm:block"></div>
                <div>
                    <p class="text-[10px] text-gray-500 uppercase tracking-widest font-bold">Portal do Aluno</p>
                    <h1 id="titulo-aula-top" class="text-sm md:text-base font-bold text-white leading-tight">Carregando aula...</h1>
                </div>
            </div>
        </div>
    </header>

    <main class="flex-1">
        <div id="app" class="conteudo-aula fade-in">
            <div class="flex flex-col items-center justify-center h-64 text-gray-500">
                <i class="fas fa-circle-notch fa-spin text-3xl mb-4 text-[#00FFFF]"></i>
                <p>Carregando conteúdo...</p>
            </div>
        </div>
    </main>

    <footer class="bg-[#111] border-t border-[#222] py-8 mt-10">
        <p class="text-center text-gray-600 text-xs">© 2025 Javis Game Academy - Material Didático Exclusivo</p>
    </footer>

    <script>
        const params = new URLSearchParams(window.location.search);
        const idAula = params.get('id');
        const token = localStorage.getItem('access_token') || (window.parent ? window.parent.localStorage.getItem('access_token') : null);

        async function carregar() {
            if(!idAula) { document.getElementById('app').innerHTML = '<p>Aula não identificada.</p>'; return; }
            
            try {
                // Busca os dados da aula (Título + Conteúdo)
                // Nota: Estou assumindo que sua API retorna { titulo: "...", html: "..." }
                // Se a API atual só retorna HTML, precisaremos ajustar.
                const res = await fetch(`https://javisgames.onrender.com/admin/aula/${idAula}/conteudo`, {
                    headers: { 'Authorization': `Bearer ${token}` } 
                });
                
                if(!res.ok) throw new Error('Falha na requisição');
                
                const dados = await res.json();
                
                // Atualiza o Título no Cabeçalho Fixo
                if(dados.titulo) document.getElementById('titulo-aula-top').innerText = dados.titulo;
                else document.getElementById('titulo-aula-top').innerText = "Conteúdo da Aula";

                if(dados.html) {
                    // LIMPEZA DE HTML (Truque importante)
                    // Se o HTML vier com <header> ou <body> antigos, o CSS '.conteudo-aula header { display:none }' vai escondê-los.
                    document.getElementById('app').innerHTML = dados.html;
                } else {
                    document.getElementById('app').innerHTML = '<div class="text-center py-10"><p class="text-yellow-500">Conteúdo ainda não criado pelo professor.</p></div>';
                }

            } catch(e) {
                console.error(e);
                document.getElementById('app').innerHTML = '<div class="text-center py-10"><p class="text-red-500">Erro ao carregar aula.</p><button onclick="location.reload()" class="mt-4 bg-[#333] text-white px-4 py-2 rounded">Tentar Novamente</button></div>';
            }
        }
        carregar();
    </script>
</body>
</html>