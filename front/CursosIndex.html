<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Portal do Aluno - Javis</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css" />
    <link rel="stylesheet" href="css/meuscursos.css" /> 
    
    <style>
        /* ESTILO PARA CURSO BLOQUEADO (SIDEBAR) */
        .course-item.locked {
            opacity: 0.6;
            cursor: not-allowed !important;
            filter: grayscale(100%);
            position: relative;
            background: #1a1a1a !important;
            border-color: #333 !important;
        }

        .course-item.locked:hover {
            transform: none !important;
            box-shadow: none !important;
        }

        .course-item.locked h3, 
        .course-item.locked i, 
        .course-item.locked p {
            color: #777 !important;
        }

        /* Ícone de Cadeado */
        .course-item.locked::after {
            content: '\f023';
            font-family: "Font Awesome 6 Free";
            font-weight: 900;
            position: absolute;
            right: 20px;
            font-size: 20px;
            color: #555;
        }

        /* Loading Overlay */
        #loadingOverlay {
            backdrop-filter: blur(5px);
        }
    </style>
</head>
<body class="min-h-screen flex flex-col bg-[#1a1a1a]">

    <header class="navbar">
        <div class="logo">
            <a href="IndexHome.html">
                <img src="assets/img/JAVIS - LOGO COM REGISTRO (BRANCO) (2).png" width="320" height="100" alt="Logo Javis">
            </a>
        </div>
        
        <ul class="nav-menu">
            <li class="nav-item"><a href="CursosIndex.html" class="nav-link active"><i class="fas fa-book"></i> Meus Cursos</a></li>
            <li class="nav-item"><a href="FinanceiroIndex.html" class="nav-link"><i class="fas fa-chalkboard-teacher"></i> Financeiro</a></li>
            <li class="nav-item"><a href="CertificadosIndex.html" class="nav-link"><i class="fas fa-graduation-cap"></i> Certificados</a></li>
            <li class="nav-item"><a href="SuporteIndex.html" class="nav-link"><i class="fas fa-headset"></i> Suporte</a></li>
        </ul>

        <div class="user-menu flex items-center gap-4">
            <div class="user-actions flex items-center gap-4">
                <div class="user-profile relative flex items-center gap-2 cursor-pointer">
                    <img src="https://ui-avatars.com/api/?name=Aluno&background=00FFFF&color=000" class="w-8 h-8 rounded-full border border-[#00FFFF]">
                    <span class="user-name text-sm font-semibold text-gray-200 hidden md:block">Minha Conta</span>
                    <i class="fas fa-chevron-down text-xs text-[#00FFFF] hidden md:block"></i>
                    
                    <div class="user-dropdown">
                        <div class="py-1">
                            <a href="#" id="btn-sair" class="dropdown-item flex items-center gap-3 px-4 py-3 text-red-400 hover:text-red-300">
                                <i class="fas fa-sign-out-alt w-5"></i> Sair
                            </a>
                        </div>
                    </div>
                </div>
            </div>
            <div class="mobile-menu-btn"><i class="fas fa-bars"></i></div>
        </div>
    </header>

    <main class="flex-grow p-4 md:p-8 flex justify-center">
        <div class="container max-w-7xl neon-container rounded-xl flex flex-col md:flex-row min-h-[600px] overflow-hidden relative">
            
            <div id="loadingOverlay" class="absolute inset-0 z-50 flex items-center justify-center bg-black/80">
                <div class="text-center">
                    <i class="fas fa-circle-notch fa-spin text-5xl text-[#00FFFF] mb-4"></i>
                    <p class="text-gray-300 animate-pulse">Carregando suas matrículas...</p>
                </div>
            </div>

            <div class="courses-section md:w-1/3 border-r border-[#333] bg-[#161616] p-4 md:p-6">
                <header class="mb-6">
                    <h1 class="text-2xl font-bold mb-1 text-[#f5f5f5]">Meus Cursos</h1>
                    <p class="text-sm text-gray-500">Selecione para ver detalhes</p>
                </header>

                <div class="courses-list space-y-3">
                    
                    <div class="course-item group flex items-center gap-4 p-3 rounded-lg cursor-pointer border border-transparent hover:border-[#00FFFF] hover:bg-[#00FFFF]/10 transition duration-300" data-course="game-pro">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center bg-[#2c2c2c] text-[#00FFFF] group-hover:bg-[#00FFFF] group-hover:text-black transition">
                            <i class="fas fa-headset text-xl"></i>
                        </div>
                        <div class="flex flex-col">
                            <h3 class="font-bold text-gray-200 group-hover:text-[#00FFFF]">GAME PRO</h3>
                            <p class="text-gray-500 text-xs">Formação ProPlayer</p>
                        </div>
                    </div>

                    <div class="course-item group flex items-center gap-4 p-3 rounded-lg cursor-pointer border border-transparent hover:border-[#00FFFF] hover:bg-[#00FFFF]/10 transition duration-300" data-course="designer-start">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center bg-[#2c2c2c] text-[#00FFFF] group-hover:bg-[#00FFFF] group-hover:text-black transition">
                            <i class="fas fa-paint-brush text-xl"></i>
                        </div>
                        <div class="flex flex-col">
                            <h3 class="font-bold text-gray-200 group-hover:text-[#00FFFF]">DESIGNER START</h3>
                            <p class="text-gray-500 text-xs">Design Gráfico</p>
                        </div>
                    </div>

                    <div class="course-item group flex items-center gap-4 p-3 rounded-lg cursor-pointer border border-transparent hover:border-[#00FFFF] hover:bg-[#00FFFF]/10 transition duration-300" data-course="game-dev">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center bg-[#2c2c2c] text-[#00FFFF] group-hover:bg-[#00FFFF] group-hover:text-black transition">
                            <i class="fas fa-code text-xl"></i>
                        </div>
                        <div class="flex flex-col">
                            <h3 class="font-bold text-gray-200 group-hover:text-[#00FFFF]">GAME DEV</h3>
                            <p class="text-gray-500 text-xs">Programação de Jogos</p>
                        </div>
                    </div>

                    <div class="course-item group flex items-center gap-4 p-3 rounded-lg cursor-pointer border border-transparent hover:border-[#00FFFF] hover:bg-[#00FFFF]/10 transition duration-300" data-course="streaming">
                        <div class="w-12 h-12 rounded-full flex items-center justify-center bg-[#2c2c2c] text-[#00FFFF] group-hover:bg-[#00FFFF] group-hover:text-black transition">
                            <i class="fas fa-video text-xl"></i>
                        </div>
                        <div class="flex flex-col">
                            <h3 class="font-bold text-gray-200 group-hover:text-[#00FFFF]">STREAMING</h3>
                            <p class="text-gray-500 text-xs">Content Creator</p>
                        </div>
                    </div>

                </div>
            </div>

            <div class="course-details-panel md:w-2/3 bg-[#111] p-6 relative">
                <div class="absolute top-0 right-0 opacity-5 pointer-events-none">
                    <i class="fas fa-gamepad text-[300px] text-[#00FFFF]"></i>
                </div>

                <div class="no-selection flex flex-col items-center justify-center text-gray-500 h-full min-h-[400px]" id="noSelection">
                    <div class="bg-[#222] p-6 rounded-full mb-4 border border-[#333]">
                        <i class="fas fa-mouse-pointer text-4xl text-[#00FFFF]"></i>
                    </div>
                    <h3 class="text-xl font-semibold mb-2 text-gray-300">Selecione um curso</h3>
                    <p class="text-center max-w-md text-sm">Clique em um dos cursos desbloqueados para visualizar o conteúdo.</p>
                </div>

                <div class="details-content hidden relative z-10" id="detailsContent">
                    <div class="details-header flex items-start gap-4 mb-6 pb-6 border-b border-[#333]">
                        <div class="text-4xl text-[#00FFFF] bg-[#00FFFF]/10 p-4 rounded-xl border border-[#00FFFF]/30" id="detailsIcon"></div>
                        <div class="flex-1">
                            <h2 class="text-2xl font-bold text-[#f5f5f5] uppercase tracking-wide" id="detailsTitle"></h2>
                            <div class="flex items-center gap-3 mt-3">
                                <div class="w-full bg-[#333] rounded-full h-2.5 overflow-hidden">
                                    <div class="bg-[#00FFFF] h-2.5 rounded-full transition-all duration-1000 shadow-[0_0_10px_#00FFFF]" id="detailsProgress" style="width: 0%;"></div>
                                </div>
                                <span class="text-xs font-bold text-[#00FFFF]" id="progressText">0%</span>
                            </div>
                        </div>
                    </div>

                    <div class="bg-[#1a1a1a] border-l-4 border-[#00FFFF] p-4 mb-6 rounded-r shadow-lg">
                        <p class="text-gray-400 text-sm leading-relaxed" id="detailsDescription"></p>
                    </div>

                    <div class="stats-grid grid grid-cols-2 md:grid-cols-4 gap-4 mb-8">
                        <div class="bg-[#1a1a1a] p-4 rounded-lg text-center border border-[#333]">
                            <div class="text-lg font-bold text-[#f5f5f5]" id="statDuration"></div>
                            <div class="text-gray-500 text-[10px] uppercase">Carga Horária</div>
                        </div>
                        <div class="bg-[#1a1a1a] p-4 rounded-lg text-center border border-[#333]">
                            <div class="text-lg font-bold text-[#f5f5f5]" id="statLevel"></div>
                            <div class="text-gray-500 text-[10px] uppercase">Nível</div>
                        </div>
                        <div class="bg-[#1a1a1a] p-4 rounded-lg text-center border border-[#333]">
                            <div class="text-lg font-bold text-[#f5f5f5]" id="statModules"></div>
                            <div class="text-gray-500 text-[10px] uppercase">Módulos</div>
                        </div>
                        <div class="bg-[#1a1a1a] p-4 rounded-lg text-center border border-[#333]">
                            <div class="text-lg font-bold text-[#00FFFF]" id="statCompleted"></div>
                            <div class="text-gray-500 text-[10px] uppercase">Concluído</div>
                        </div>
                    </div>

                    <h3 class="text-lg font-bold mb-4 text-[#f5f5f5] flex items-center gap-2 border-b border-[#333] pb-2 w-fit">
                        <i class="fas fa-layer-group text-[#00FFFF]"></i> Conteúdo Programático
                    </h3>
                    
                    <div class="modules-list space-y-3" id="modulesList"></div>
                </div>
            </div>
        </div>
    </main>

    <div id="replitModal" class="fixed inset-0 z-50 hidden bg-black/90 backdrop-blur-sm flex items-center justify-center p-4">
        <div class="bg-[#161616] w-full max-w-[95%] h-[90vh] rounded-xl border border-[#00FFFF] shadow-[0_0_30px_rgba(0,255,255,0.2)] flex flex-col overflow-hidden relative">
            
            <div class="flex justify-between items-center p-4 border-b border-[#333] bg-[#1a1a1a]">
                <div class="flex items-center gap-3">
                    <i class="fas fa-code text-[#00FFFF]"></i>
                    <h3 id="modalTitle" class="text-gray-200 font-bold">Ambiente de Desenvolvimento</h3>
                </div>
                <button onclick="closeReplit()" class="text-gray-400 hover:text-red-500 transition">
                    <i class="fas fa-times text-xl"></i>
                </button>
            </div>

            <div class="flex flex-grow overflow-hidden">
                <div class="w-1/3 bg-[#111] border-r border-[#333] flex flex-col overflow-y-auto">
                    <div class="p-5 text-gray-300 space-y-4">
                        <h4 class="text-[#00FFFF] font-bold text-lg mb-2">Resumo da Aula</h4>
                        <div id="lessonContent" class="text-sm leading-relaxed space-y-4">
                            <p>Carregando instruções...</p>
                        </div>
                        <div class="mt-6 bg-[#2c2c2c] border border-[#00FFFF]/30 p-4 rounded-lg">
                            <h5 class="text-[#00FFFF] font-bold text-xs uppercase mb-2"><i class="fas fa-flag"></i> Desafio Prático</h5>
                            <p id="lessonChallenge" class="text-xs text-gray-400">...</p>
                        </div>
                    </div>
                </div>

                <div class="w-2/3 relative bg-black flex flex-col">
                    <div class="bg-[#222] px-4 py-2 flex flex-wrap gap-4 text-xs border-b border-[#333] shrink-0">
                        <div class="flex items-center gap-2">
                            <span class="bg-[#00ff00] text-black font-bold px-2 py-0.5 rounded">Run</span>
                            <span class="text-gray-400">= Iniciar (Botão Play no topo)</span>
                        </div>
                        <div class="ml-auto text-yellow-500 flex items-center gap-1">
                            <i class="fas fa-exclamation-triangle"></i>
                            <span>Atenção: Não use o tradutor do Google aqui!</span>
                        </div>
                    </div>
                    <div id="iframeContainer" class="flex-grow relative w-full h-full"></div>
                </div>
            </div>
        </div>
    </div>
    
    <script>
    // === CONFIGURAÇÃO DA API (SEU BACKEND) ===
    const API_BASE_URL = 'https://javisgames.onrender.com';

    // === DADOS ESTÁTICOS DOS CURSOS (Conteúdo programático) ===
    const resourceLinks = { 'default': 'https://design-e-inovacao-q4bjgfq.gamma.site/' };

    const courseData = {
        'game-pro': {
            title: 'GAME PRO', icon: 'fas fa-headset', description: 'Formação completa para ProPlayers e atletas digitais.',
            progress: 0, duration: '160h', level: 'Avançado', modules: 4, completed: '0/4',
            modulesList: [
                { name: 'Módulo 1: Fundamentos', submodules: ['Aula 1: Introdução', 'Aula 2: Mecânicas'] },
                { name: 'Módulo 2: Estratégia', submodules: ['Aula 3: Mapas', 'Aula 4: Economia'] }
            ]
        },
        'designer-start': {
            title: 'DESIGNER START', icon: 'fas fa-paint-brush', description: 'Domine Photoshop, Illustrator e Premiere.',
            progress: 0, duration: '120h', level: 'Iniciante', modules: 8, completed: '0/8',
            modulesList: [ { name: 'Módulo 1: Canva', submodules: ['Aula 1: Interface', 'Aula 2: Posts'] } ]
        },
        'game-dev': {
            title: 'GAME DEV', icon: 'fas fa-code', description: 'Crie jogos do zero com Python e Pygame.',
            progress: 0, duration: '60h', level: 'Do Zero ao Pro', modules: 5, completed: '0/24', 
            modulesList: [
                { name: 'Módulo 1: O Iniciante', submodules: ['Aula 01: O Primeiro Contato', 'Aula 02: Variáveis', 'Aula 03: Controle (IF)', 'Aula 04: Limites', 'Aula 05: Fuga do Quadrado'] },
                { name: 'Módulo 2: O Criador', submodules: ['Aula 06: Sprites', 'Aula 07: Listas', 'Aula 08: Limpeza', 'Aula 09: Tiros', 'Aula 10: Colisões'] },
                { name: 'Módulo 3: O Designer', submodules: ['Aula 11: Som', 'Aula 12: Texto', 'Aula 13: Menus'] },
                { name: 'Módulo 4: O Físico', submodules: ['Aula 14: Grids', 'Aula 15: Gravidade', 'Aula 16: Pulo', 'Aula 17: Câmera'] },
                { name: 'Módulo 5: Profissional', submodules: ['Aula 18: Classes (OOP)', 'Aula 19: Inteligência Artificial', 'Aula 20: Game Juice', 'Aula 21: Save & Highscore', 'Aula 22: Git & GitHub', 'Aula 23: Publicação', 'Aula 24: A Grande Feira'] }
            ]
        },
        'streaming': {
            title: 'STREAMING', icon: 'fas fa-video', description: 'Torne-se um criador de conteúdo profissional.',
            progress: 0, duration: '60h', level: 'Todos', modules: 5, completed: '0/5',
            modulesList: [ { name: 'Módulo 1: OBS Studio', submodules: ['Aula 1: Configuração', 'Aula 2: Cenas'] } ]
        }
    };

    let userPermissions = [];

    // === INICIALIZAÇÃO ===
    document.addEventListener('DOMContentLoaded', async function () {
        const courseItems = document.querySelectorAll('.course-item');
        const token = localStorage.getItem('access_token');
        const loadingOverlay = document.getElementById('loadingOverlay');

        if (!token) {
            alert("Sessão expirada. Por favor, faça login novamente.");
            window.location.href = "IndexHome.html"; // Redireciona se não tiver token
            return;
        }

        // 1. BUSCA PERMISSÕES NO SEU BACKEND PYTHON
        try {
            const response = await fetch(`${API_BASE_URL}/meus-cursos-permitidos`, {
                method: 'GET',
                headers: {
                    'Authorization': `Bearer ${token}`,
                    'Content-Type': 'application/json'
                }
            });

            if (response.ok) {
                const data = await response.json();
                userPermissions = data.cursos; // O Backend retorna { "cursos": [{id: "game-dev", data_inicio: "..."}] }
            } else {
                console.error("Erro ao buscar permissões:", response.status);
                // Fallback para testes se o backend estiver dormindo (Render free tier)
                userPermissions = [{ id: 'game-dev', data_inicio: '2023-01-01' }]; 
            }
        } catch (error) {
            console.error("Erro de conexão:", error);
            // Fallback de emergência
            userPermissions = [{ id: 'game-dev', data_inicio: '2023-01-01' }];
        } finally {
            // Remove o loading
            loadingOverlay.classList.add('hidden');
        }

        // 2. APLICA A LÓGICA DE BLOQUEIO VISUAL
        courseItems.forEach(item => {
            const courseId = item.dataset.course;
            const permission = userPermissions.find(p => p.id === courseId);

            if (!permission) {
                // BLOQUEADO
                item.classList.add('locked');
                item.setAttribute('title', 'Matrícula não encontrada');
                item.addEventListener('click', (e) => {
                    e.stopImmediatePropagation();
                    e.preventDefault();
                    alert("Você não possui matrícula ativa neste curso.");
                }, true);
            } else {
                // LIBERADO
                item.addEventListener('click', function () {
                    // Reset visual dos outros
                    courseItems.forEach(i => {
                        if(!i.classList.contains('locked')){
                            i.classList.remove('border-[#00FFFF]', 'bg-[#00FFFF]/10');
                            i.classList.add('border-transparent');
                            const icon = i.querySelector('div:first-child');
                            const title = i.querySelector('h3');
                            if(icon) { icon.classList.remove('bg-[#00FFFF]', 'text-black'); icon.classList.add('bg-[#2c2c2c]', 'text-[#00FFFF]'); }
                            if(title) { title.classList.remove('text-[#00FFFF]'); title.classList.add('text-gray-200'); }
                        }
                    });
                    
                    // Ativa o clicado
                    this.classList.remove('border-transparent');
                    this.classList.add('border-[#00FFFF]', 'bg-[#00FFFF]/10');
                    const activeIcon = this.querySelector('div:first-child');
                    const activeTitle = this.querySelector('h3');
                    if(activeIcon) { activeIcon.classList.remove('bg-[#2c2c2c]', 'text-[#00FFFF]'); activeIcon.classList.add('bg-[#00FFFF]', 'text-black'); }
                    if(activeTitle) { activeTitle.classList.remove('text-gray-200'); activeTitle.classList.add('text-[#00FFFF]'); }

                    // Carrega detalhes usando a DATA DA MATRÍCULA vinda do Backend
                    showCourseDetails(courseId, permission.data_inicio);
                });
            }
        });

        // 3. Botão Sair
        const btnSair = document.getElementById('btn-sair');
        if(btnSair){
            btnSair.addEventListener('click', (e) => {
                e.preventDefault();
                localStorage.removeItem('access_token');
                window.location.href = "IndexHome.html";
            });
        }

        // 4. Mobile Menu
        const mobileMenuBtn = document.querySelector('.mobile-menu-btn');
        const navMenu = document.querySelector('.nav-menu');
        const userProfile = document.querySelector('.user-profile');
        const userDropdown = document.querySelector('.user-dropdown');
        if(mobileMenuBtn) mobileMenuBtn.addEventListener('click', () => navMenu.classList.toggle('active'));
        if(userProfile) {
            userProfile.addEventListener('click', (e) => {
                e.stopPropagation();
                userDropdown.classList.toggle('active');
            });
        }
        document.addEventListener('click', () => { if(userDropdown) userDropdown.classList.remove('active'); });
    });

    // === FUNÇÕES DO MODAL ===
    // Função atualizada para buscar dados reais e FORMATAR O CÓDIGO
    async function openReplit(url, aulaTitulo) {
        const modal = document.getElementById('replitModal');
        const iframeContainer = document.getElementById('iframeContainer');
        const titleElement = document.getElementById('modalTitle');
        const contentElement = document.getElementById('lessonContent');
        const challengeElement = document.getElementById('lessonChallenge');

        // 1. Reset visual e Mostra Carregando
        titleElement.textContent = aulaTitulo;
        contentElement.innerHTML = `<p class="text-gray-500 animate-pulse">Carregando conteúdo do banco de dados...</p>`;
        challengeElement.textContent = "...";
        modal.classList.remove('hidden');

        // 2. Busca o conteúdo no Backend
        try {
            const encodedTitle = encodeURIComponent(aulaTitulo);
            const response = await fetch(`${API_BASE_URL}/conteudo-aula?titulo=${encodedTitle}`, {
                method: 'GET',
                headers: { 'Content-Type': 'application/json' }
            });

            if (response.ok) {
                const data = await response.json();
                
                // === CORREÇÃO AQUI ===
                // Se vier "\n" literal do banco, transformamos em quebra de linha real
                let codigoLimpo = data.codigo_exemplo || "";
                codigoLimpo = codigoLimpo.replace(/\\n/g, '\n'); 

                // 3. Preenche com os dados do banco
                contentElement.innerHTML = `
                    <p class="mb-4 text-gray-300">${data.script}</p>
                    
                    <div class="bg-[#111] border border-[#333] rounded-lg overflow-hidden">
                        <div class="bg-[#222] px-3 py-1 border-b border-[#333] flex justify-between items-center">
                            <span class="text-[10px] text-gray-500 uppercase font-bold">Exemplo de Código</span>
                            <button onclick="navigator.clipboard.writeText(this.dataset.code)" data-code="${codigoLimpo.replace(/"/g, '&quot;')}" class="text-[10px] text-[#00FFFF] hover:text-white transition">
                                <i class="fas fa-copy"></i> Copiar
                            </button>
                        </div>
                        <div class="p-3 overflow-x-auto">
                            <pre class="text-xs text-green-400 font-mono whitespace-pre" style="margin:0;">${codigoLimpo}</pre>
                        </div>
                    </div>

                    <ul class="list-disc pl-4 space-y-1 text-gray-500 mt-4 text-xs">
                        <li>Copie o exemplo acima para o <strong>main.py</strong> ao lado.</li>
                        <li>Clique no botão <strong>Run</strong> (Play) para testar.</li>
                    </ul>
                `;
                challengeElement.textContent = data.desafio;

            } else {
                contentElement.innerHTML = `<p class="text-red-400">Conteúdo não encontrado para esta aula.</p>`;
            }

        } catch (error) {
            console.error("Erro:", error);
            contentElement.innerHTML = `<p class="text-red-400">Erro de conexão com o servidor.</p>`;
        }

        // 4. Injeta o Iframe (Trinket)
        iframeContainer.innerHTML = `
            <iframe 
                src="${url}" 
                width="100%" 
                height="100%" 
                frameborder="0" 
                marginwidth="0" 
                marginheight="0" 
                allowfullscreen>
            </iframe>
            <div class="absolute inset-0 flex items-center justify-center bg-[#161616] z-[-1]">
                <i class="fas fa-circle-notch fa-spin text-4xl text-[#00FFFF]"></i>
            </div>
        `;
    }

    function closeReplit() {
        const modal = document.getElementById('replitModal');
        const iframeContainer = document.getElementById('iframeContainer');
        modal.classList.add('hidden');
        iframeContainer.innerHTML = ''; 
    }

    // === RENDERIZAÇÃO ===
    function showCourseDetails(courseId, dataMatricula) {
        const course = courseData[courseId];
        if (!course) return;

        const hoje = new Date();
        const dataInicio = new Date(dataMatricula);
        const diferencaTempo = hoje - dataInicio;
        const diasPassados = Math.floor(diferencaTempo / (1000 * 60 * 60 * 24)); 

        document.getElementById('noSelection').classList.add('hidden');
        document.getElementById('detailsContent').classList.remove('hidden');
        document.getElementById('detailsIcon').innerHTML = `<i class="${course.icon}"></i>`;
        document.getElementById('detailsTitle').textContent = course.title;
        document.getElementById('detailsDescription').textContent = course.description;
        
        const progressBar = document.getElementById('detailsProgress');
        progressBar.style.width = '0%';
        setTimeout(() => progressBar.style.width = `${course.progress}%`, 100);
        document.getElementById('progressText').textContent = `${course.progress}%`;
        document.getElementById('statDuration').textContent = course.duration;
        document.getElementById('statLevel').textContent = course.level;
        document.getElementById('statModules').textContent = course.modules;
        document.getElementById('statCompleted').textContent = course.completed;

        const modulesList = document.getElementById('modulesList');
        modulesList.innerHTML = '';

        let contadorAulaGlobal = 0; 

        course.modulesList.forEach((module, index) => {
            const moduleId = `module-${index}`;
            const submodulesHTML = module.submodules.map(submodule => {
                
                // Regra: 1 aula liberada por semana
                const diasNecessarios = contadorAulaGlobal * 7; 
                
                // Se for Game Dev, destrava para testes. Caso contrário, segue a regra.
                const estaBloqueada = diasPassados < diasNecessarios;
                const diasFaltantes = diasNecessarios - diasPassados;
                
                contadorAulaGlobal++;

                const trinketUrl = "https://trinket.io/embed/pygame/b96aa43355e3?showInstructions=true&toggleCode=true&runOption=run";
                let clickAction = '';
                let iconClass = 'far fa-play-circle';
                let itemLink = resourceLinks['default'];
                let targetAttr = 'target="_blank"';
                let extraBadge = '';

                if (courseId === 'game-dev') {
                    itemLink = 'javascript:void(0)';
                    targetAttr = '';
                    clickAction = `onclick="openReplit('${trinketUrl}', '${submodule}')"`; 
                    iconClass = 'fas fa-terminal'; 
                    extraBadge = '<span class="ml-auto text-[10px] bg-[#2c2c2c] px-2 py-1 rounded text-[#00FFFF] border border-[#00FFFF]/30 uppercase hover:bg-[#00FFFF] hover:text-black transition">Praticar</span>';
                }
                
                if (estaBloqueada) {
                    return `
                        <div class="flex items-center justify-between p-3 pl-6 border-b border-[#222] last:border-0 bg-[#1a1a1a] opacity-50 cursor-not-allowed">
                            <div class="flex items-center gap-3">
                                <i class="fas fa-lock text-gray-500"></i>
                                <span class="text-sm text-gray-500">${submodule}</span>
                            </div>
                            <span class="text-[10px] text-red-400 border border-red-900 bg-red-900/20 px-2 py-1 rounded">Libera em ${diasFaltantes} dia(s)</span>
                        </div>`;
                } else {
                    return `
                        <a href="${itemLink}" ${targetAttr} ${clickAction} class="flex items-center gap-3 p-3 pl-6 hover:bg-[#00FFFF]/10 text-gray-400 hover:text-[#00FFFF] border-b border-[#222] last:border-0 transition duration-200 group">
                            <i class="${iconClass} text-[#00FFFF] opacity-70 group-hover:opacity-100"></i>
                            <span class="text-sm">${submodule}</span>
                            ${extraBadge}
                        </a>`;
                }
            }).join('');

            const moduleItem = document.createElement('div');
            moduleItem.className = 'module-item border border-[#333] rounded-lg overflow-hidden bg-[#161616] mb-3';
            moduleItem.innerHTML = `
                <div class="module-header p-4 cursor-pointer flex justify-between items-center hover:bg-[#222] transition select-none" onclick="toggleSubmodules('${moduleId}')">
                    <div class="flex items-center gap-3 font-semibold text-gray-300">
                        <span class="bg-[#00FFFF]/10 text-[#00FFFF] text-[10px] px-2 py-1 rounded border border-[#00FFFF]/20 uppercase tracking-wider">Módulo ${index + 1}</span>
                        <span class="module-title">${module.name}</span>
                    </div>
                    <i class="fas fa-chevron-down text-[#00FFFF] transition-transform duration-300" id="icon-${moduleId}"></i>
                </div>
                <div class="submodules-list hidden bg-[#1a1a1a] border-t border-[#333]" id="${moduleId}">
                    ${submodulesHTML}
                </div>
            `;
            modulesList.appendChild(moduleItem);
        });
    }

    function toggleSubmodules(id) {
        const content = document.getElementById(id);
        const icon = document.getElementById(`icon-${id}`);
        content.classList.toggle('hidden');
        icon.style.transform = content.classList.contains('hidden') ? 'rotate(0deg)' : 'rotate(180deg)';
    }
    </script>
</body>
</html>